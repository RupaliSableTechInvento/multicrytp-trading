{"version":3,"sources":["../../src/controller/walletController.js"],"names":["bcypher","require","console","log","URL_ROOT","TOKEN","bcapibtc","bcapiltc","bcapidoge","bitcoin","bigi","buffer","CAValidator","coin","BTC","LTC","DOGE","walletController","createWalletWithAddress","req","res","decoded","verify","headers","App_key","_id","body","dataObj","CoinCode","name","item","data","toString","addresses","createWallet","err","wallets","json","isError","error","genAddrWallet","walletsData","tempObj","isAddressCreated","$setObj","updateQuery","findOneAndUpdate","email","$set","new","user","getCoin_WalletData","find","users","redirect","getAddrFull","query","address","getAddrBal","newTransaction","amount","receiverAddress","privateKey","senderAddress","dataRes","key","wallet_namesData","private","parseInt","tx","inputs","outputs","value","newTX","newTXres","pubkeys","keys","ECPair","fromHex","signatures","tosign","map","n","push","getPublicKeyBuffer","sign","Buffer","toDER","sendTX","result","getTX","hash","getChain","listWallets","wallet_names","forEach","delWallet","element","validateAddress","network","networkType","chain","valid","validate"],"mappings":"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","file":"walletController.js","sourcesContent":["var bcypher = require('blockcypher');\r\nimport usersModel from '../models/usersModel'\r\n\r\nimport jwt from 'jsonwebtoken';\r\nimport env from \"../env\";\r\nimport async from 'async'\r\n\r\nconsole.log('Welcome to BlockCypher');\r\nconst URL_ROOT = 'https://api.blockcypher.com/v1/';\r\nconst TOKEN = 'e42bb9107d4d49e6b74d4153bddcde3c';\r\nvar bcapibtc = new bcypher('btc', 'test3', TOKEN);\r\nvar bcapiltc = new bcypher('ltc', 'main', TOKEN);\r\nvar bcapidoge = new bcypher('doge', 'main', TOKEN);\r\nvar bitcoin = require(\"bitcoinjs-lib\");\r\nvar bigi = require(\"bigi\");\r\nvar buffer = require('buffer');\r\nvar CAValidator = require('crypto-address-validator');\r\nvar coin = { BTC: bcapibtc, LTC: bcapiltc, DOGE: bcapidoge };\r\n\r\nconst walletController = {\r\n\r\n  createWalletWithAddress: (req, res) => {\r\n    var decoded = jwt.verify(req.headers['authorization'], env.App_key);\r\n    console.log(\"createWalletWithAddress ==>\", decoded._id, req.body.dataObj);\r\n\r\n    var CoinCode = req.body.dataObj.coin;\r\n    var name = decoded._id;\r\n    var item = coin[req.body.dataObj.coin];\r\n    var data = { name: name.toString(), addresses: [] }\r\n    console.log(\"Coin==>item coinCode\", item, CoinCode);\r\n    item.createWallet(data, function(err, wallets) {\r\n      if (err) {\r\n        return\r\n        res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n\r\n      } else {\r\n        if (!wallets.error) {\r\n\r\n\r\n          item.genAddrWallet(wallets.name, function(err, walletsData) {\r\n            if (err) {\r\n              res.json({\r\n                isError: true,\r\n                data: err\r\n              });\r\n            } else {\r\n              var tempObj = {};\r\n              tempObj[CoinCode] = walletsData;\r\n              walletsData.isAddressCreated = true;\r\n              var $setObj = {};\r\n              var updateQuery = 'wallets.' + CoinCode;\r\n              $setObj[updateQuery] = walletsData;\r\n              console.log(\"$setObj=>\", $setObj);\r\n\r\n              //  wallets[CoinCode];\r\n              console.log(\"tempObj=>\", tempObj, updateQuery, walletsData);\r\n\r\n              usersModel.findOneAndUpdate({\r\n                email: decoded.email\r\n              }, {\r\n                $set: $setObj\r\n              }, {\r\n                new: true\r\n              }, (err, user) => {\r\n\r\n                if (err) return res.json({\r\n                  isError: true,\r\n                  data: err\r\n                });\r\n                res.json({\r\n                  isError: false,\r\n                  data: user\r\n                })\r\n              });\r\n            }\r\n          })\r\n        } else {\r\n          res.json({\r\n            isError: true,\r\n            data: wallets.error\r\n          });\r\n\r\n        }\r\n      }\r\n    });\r\n  },\r\n  getCoin_WalletData: (req, res) => {\r\n    var decoded = jwt.verify(req.headers['authorization'], env.App_key);\r\n    console.log(\"getCoin_WalletData ==>\", decoded._id);\r\n    usersModel.find({\r\n      'email': decoded.email\r\n    }, (err, users) => {\r\n      if (err) return res.json({\r\n        isError: true,\r\n        data: err\r\n      });\r\n\r\n      if (users) {\r\n        res.json({\r\n          isError: false,\r\n          data: users,\r\n        });\r\n      } else {\r\n        res.redirect('/#/login');\r\n      }\r\n\r\n    });\r\n  },\r\n  getAddrFull: (req, res) => {\r\n    var decoded = jwt.verify(req.headers['authorization'], env.App_key);\r\n    console.log(\"getAddr ==>\", decoded._id, req.query);\r\n\r\n    var CoinCode = req.query.dataObj.coin;\r\n    var address = req.query.dataObj.address;\r\n    var item = coin[CoinCode];\r\n    console.log(\"Coin==>getAddr item coinCode\", item, CoinCode);\r\n\r\n\r\n\r\n    item.getAddrFull(address, {}, function(err, body) {\r\n      console.log(\"getAddr==>0\", body);\r\n\r\n      res.json(body);\r\n    })\r\n\r\n  },\r\n  getAddrBal: (req, res) => {\r\n\r\n    var decoded = jwt.verify(req.headers['authorization'], env.App_key);\r\n    console.log(\"getAddrBal ==>\", decoded._id, req.body.dataObj);\r\n\r\n    var CoinCode = req.body.dataObj.coin;\r\n    var address = req.body.dataObj.address;\r\n    var item = coin[req.body.dataObj.coin];\r\n    // var data = { name: name.toString(), addresses: [] }\r\n    console.log(\"Coin==>getAddrBal item coinCode\", item, CoinCode);\r\n    item.getAddrFull(address, {}, function(err, body) {\r\n      console.log(\"getAddrFull==>0\", body);\r\n\r\n      res.json(body);\r\n    })\r\n\r\n  },\r\n  newTransaction: (req, res) => {\r\n    var decoded = jwt.verify(req.headers['authorization'], env.App_key);\r\n    console.log(\"newTransaction ==>\", decoded._id, req.body.dataObj);\r\n\r\n    var CoinCode = req.body.dataObj.coin;\r\n    var address = req.body.dataObj.address;\r\n    var item = coin[req.body.dataObj.coin];\r\n    var amount = req.body.dataObj.amount;\r\n    var receiverAddress = req.body.dataObj.receiverAddress;\r\n    console.log();\r\n\r\n    usersModel.find({\r\n      'email': decoded.email\r\n    }, (err, users) => {\r\n      if (err) {\r\n        return res.json({\r\n          isError: true,\r\n          data: err\r\n        });\r\n      } else {\r\n        if (users) {\r\n          var wallets = {}\r\n          var privateKey = '';\r\n          var senderAddress = '';\r\n\r\n          var dataRes = users[0].wallets;\r\n          console.log(\"newTransaction user data==>\", users, dataRes);\r\n\r\n          for (var key in dataRes) {\r\n            if (key.toString() == CoinCode.toString()) {\r\n\r\n              var wallet_namesData = dataRes[key]\r\n              console.log(\"newTransaction key matched.==>\", wallet_namesData.private);\r\n              privateKey = wallet_namesData.private\r\n              senderAddress = wallet_namesData.address\r\n            }\r\n\r\n          }\r\n          if (privateKey) {\r\n\r\n            amount = parseInt(amount);\r\n            var tx = {\r\n              inputs: [{ addresses: [senderAddress] }],\r\n              outputs: [{ addresses: [receiverAddress], value: amount }]\r\n            };\r\n\r\n\r\n\r\n            item.newTX(tx, function(err, newTXres) {\r\n\r\n              if (err) {\r\n                console.log(\"newTX error==>\", err);\r\n\r\n              } else {\r\n                newTXres.pubkeys = [];\r\n                //private key for that address\r\n                var keys = new bitcoin.ECPair(bigi.fromHex(privateKey));\r\n                newTXres.signatures = newTXres.tosign.map(function(tosign, n) {\r\n                  newTXres.pubkeys.push(keys.getPublicKeyBuffer().toString(\"hex\"));\r\n                  return keys.sign(new buffer.Buffer(tosign, \"hex\")).toDER().toString(\"hex\");\r\n                });\r\n                item.sendTX(newTXres, function(err, result) {\r\n                    if (err) {\r\n                      // console.log(\"sendTX error==>\", err);\r\n\r\n                      res.json({\r\n                        isError: true,\r\n                        data: result,\r\n                      });\r\n\r\n                    } else {\r\n                      // console.log(\"sendTX==>\", result);\r\n                      res.json({\r\n                        isError: false,\r\n                        data: result,\r\n                      });\r\n\r\n\r\n\r\n                    }\r\n                  })\r\n                  // getAddrBal(toaddress);\r\n\r\n              }\r\n\r\n\r\n            })\r\n\r\n          }\r\n\r\n\r\n\r\n\r\n\r\n        }\r\n      }\r\n\r\n    });\r\n\r\n\r\n    // var data = { name: name.toString(), addresses: [] }\r\n    // console.log(\"Coin==>getAddrBal item coinCode\", item, CoinCode);\r\n    // item.getAddrFull(address, {}, function(err, body) {\r\n    //   console.log(\"getAddrFull==>0\", body);\r\n\r\n    //   res.json(body);\r\n    // })\r\n  },\r\n  getTX: (req, res) => {\r\n    var hash = req.body.dataObj.hash;\r\n    var CoinCode = req.body.dataObj.coin;\r\n    var item = coin[req.body.dataObj.coin];\r\n    // item.getTXConf(hash, function(err, body) {\r\n    //   console.log(\"getTXConf==>0\", body);\r\n\r\n    //   res.json(body);\r\n    // })\r\n    item.getChain(function(err, body) {\r\n        console.log(\"getChain==>\", err, body);\r\n        res.json(body);\r\n      })\r\n      // item.getTX(hash, {}, function(err, body) {\r\n      //     // console.log(\"getTX==>\", body);\r\n      //     res.json(body);\r\n      //   })\r\n      // getTX = function(hash,{}, cb) {\r\n      //   this._get('/txs/' + hash, {}, function(error, body) {\r\n      //     cb(error, body);\r\n      //   });\r\n      // };\r\n  },\r\n\r\n  listWallets: (req, res) => {\r\n    item.listWallets(function(err, wallets) {\r\n      if (err) {\r\n        // console.log(\"error in item\");\r\n\r\n      } else {\r\n        console.log('listWallets==>', wallets);\r\n        wallets.wallet_names.forEach(element => {\r\n\r\n\r\n        });\r\n\r\n      }\r\n    })\r\n  },\r\n  delWallet: (req, res) => {\r\n    //req wallet name as parameter\r\n    item.delWallet(element, function(err, res) {\r\n      if (err) {\r\n        console.log(\"error in delWallet==>\", err);\r\n\r\n      }\r\n      console.log(\"res==>\", res);\r\n\r\n    })\r\n  },\r\n  validateAddress: (req, res) => {\r\n    console.log(\" validateAddress req==>\", req.query, req.body);\r\n\r\n    var CoinCode = req.query.coin;\r\n    var address = req.query.receiverAddress;\r\n    var network = '';\r\n    network = coin[CoinCode];\r\n    var networkType = network.chain;\r\n    console.log('CoinCode address', address, CoinCode);\r\n\r\n\r\n    var valid = CAValidator.validate(address, CoinCode, networkType);\r\n    if (valid) {\r\n      console.log('This is a valid address');\r\n      res.json({\r\n        isError: false,\r\n        valid: valid\r\n      })\r\n    } else {\r\n      console.log('Address INVALID');\r\n\r\n      res.json({ isError: true, valid: valid })\r\n    }\r\n\r\n  }\r\n}\r\nexport default walletController;"]}