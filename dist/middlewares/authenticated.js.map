{"version":3,"sources":["../../src/middlewares/authenticated.js"],"names":["authenticated","req","res","next","token","headers","today","Date","findOne","$and","expiry","$gt","err","user","json","isError","data","verify","App_key","decode"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxC;AACA,MAAMC,QAAQH,IAAII,OAAJ,CAAY,eAAZ,CAAd;AACA,MAAIC,QAAQ,IAAIC,IAAJ,EAAZ;AACA,uBAAWC,OAAX,CAAmB;AACjBC,UAAM,CAAC;AACL,eAASL;AADJ,KAAD,EAEH;AACD,kBAAY;AADX,KAFG,EAIH;AACDM,cAAQ;AACNC,aAAKL;AADC;AADP,KAJG;AADW,GAAnB,EAUG,UAACM,GAAD,EAAMC,IAAN,EAAe;AAChB,QAAID,GAAJ,EAAS;AACPV,UAAIY,IAAJ,CAAS;AACPC,iBAAS,IADF;AAEPC,cAAMJ;AAFC,OAAT;AAID,KALD,MAKO;AACL,UAAIC,QAAQ,IAAZ,EAAkB;AAChB;AACA,+BAAII,MAAJ,CAAWb,KAAX,EAAkB,cAAIc,OAAtB,EAA+B,UAACN,GAAD,EAAMO,MAAN,EAAiB;AAC9C,cAAIP,GAAJ,EAAS;AACPV,gBAAIY,IAAJ,CAAS;AACPC,uBAAS,IADF;AAEPC,oBAAMJ;AAFC,aAAT;AAID,WALD,MAKO;AACLT;AACD;AACF,SATD;AAUD,OAZD,MAYO;AACLD,YAAIY,IAAJ,CAAS;AACPC,mBAAS,IADF;AAEPC,gBAAM;AAFC,SAAT;AAID;AACF;AACF,GApCD;AAsCD,CA1CD;AA2CA;AACA;AACA;kBACehB,a","file":"authenticated.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport env from \"../env\";\nimport tokenModel from './../models/tokenModel';\nconst authenticated = (req, res, next) => {\n  // console.log(\"req.headers\", req.headers)\n  const token = req.headers['authorization'];\n  var today = new Date();\n  tokenModel.findOne({\n    $and: [{\n      'token': token\n    }, {\n      'isActive': 'active'\n    }, {\n      expiry: {\n        $gt: today\n      }\n    }]\n  }, (err, user) => {\n    if (err) {\n      res.json({\n        isError: true,\n        data: err\n      });\n    } else {\n      if (user != null) {\n        // console.log(\"-------------\",user);\n        jwt.verify(token, env.App_key, (err, decode) => {\n          if (err) {\n            res.json({\n              isError: true,\n              data: err\n            })\n          } else {\n            next()\n          }\n        });\n      } else {\n        res.json({\n          isError: true,\n          data: \"Middle Order Login Again\"\n        })\n      }\n    }\n  });\n\n};\n// const authenticated = (req, res, next) => {\n//\n// }\nexport default authenticated;"]}