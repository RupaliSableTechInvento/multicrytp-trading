{"version":3,"sources":["../../src/middlewares/authenticated.js"],"names":["authenticated","req","res","next","console","log","headers","token","today","Date","findOne","$and","expiry","$gt","err","user","json","isError","data","verify","App_key","decode"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxCC,UAAQC,GAAR,CAAY,aAAZ,EAA2BJ,IAAIK,OAA/B;AACA,MAAMC,QAAQN,IAAIK,OAAJ,CAAY,eAAZ,CAAd;AACA,MAAIE,QAAQ,IAAIC,IAAJ,EAAZ;AACA,uBAAWC,OAAX,CAAmB,EAAEC,MAAM,CAAC,EAAE,SAASJ,KAAX,EAAD,EAAqB,EAAE,YAAY,QAAd,EAArB,EAA+C,EAAEK,QAAQ,EAAEC,KAAKL,KAAP,EAAV,EAA/C,CAAR,EAAnB,EAAyG,UAACM,GAAD,EAAMC,IAAN,EAAe;AACtH,QAAID,GAAJ,EAAS;AACPZ,UAAIc,IAAJ,CAAS,EAAEC,SAAS,IAAX,EAAiBC,MAAMJ,GAAvB,EAAT;AACD,KAFD,MAEO;AACL,UAAIC,QAAQ,IAAZ,EAAkB;AAChB;AACA,+BAAII,MAAJ,CAAWZ,KAAX,EAAkB,cAAIa,OAAtB,EAA+B,UAACN,GAAD,EAAMO,MAAN,EAAiB;AAC9C,cAAIP,GAAJ,EAAS;AACPZ,gBAAIc,IAAJ,CAAS,EAAEC,SAAS,IAAX,EAAiBC,MAAMJ,GAAvB,EAAT;AACD,WAFD,MAEO;AACLX;AACD;AACF,SAND;AAOD,OATD,MASO;AACLD,YAAIc,IAAJ,CAAS,EAAEC,SAAS,IAAX,EAAiBC,MAAM,0BAAvB,EAAT;AACD;AACF;AACF,GAjBD;AAmBD,CAvBD;AAwBA;AACA;AACA;kBACelB,a","file":"authenticated.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport env from \"../env\";\nimport tokenModel from './../models/tokenModel';\nconst authenticated = (req, res, next) => {\n  console.log(\"req.headers\", req.headers)\n  const token = req.headers['authorization'];\n  var today = new Date();\n  tokenModel.findOne({ $and: [{ 'token': token }, { 'isActive': 'active' }, { expiry: { $gt: today } }] }, (err, user) => {\n    if (err) {\n      res.json({ isError: true, data: err });\n    } else {\n      if (user != null) {\n        // console.log(\"-------------\",user);\n        jwt.verify(token, env.App_key, (err, decode) => {\n          if (err) {\n            res.json({ isError: true, data: err })\n          } else {\n            next()\n          }\n        });\n      } else {\n        res.json({ isError: true, data: \"Middle Order Login Again\" })\n      }\n    }\n  });\n\n};\n// const authenticated = (req, res, next) => {\n//\n// }\nexport default authenticated;"]}