{"version":3,"sources":["../../src/middlewares/authenticated.js"],"names":["authenticated","req","res","next","token","headers","today","Date","findOne","$and","expiry","$gt","err","user","json","isError","data","verify","App_key","decode"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AACA,IAAMA,gBAAgB,SAAhBA,aAAgB,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACtC,MAAMC,QAAQH,IAAII,OAAJ,CAAY,eAAZ,CAAd;AACA,MAAIC,QAAM,IAAIC,IAAJ,EAAV;AACA,uBAAWC,OAAX,CAAmB,EAACC,MAAK,CAAC,EAAC,SAAQL,KAAT,EAAD,EAAiB,EAAC,YAAW,QAAZ,EAAjB,EAAuC,EAACM,QAAO,EAACC,KAAIL,KAAL,EAAR,EAAvC,CAAN,EAAnB,EAAuF,UAACM,GAAD,EAAMC,IAAN,EAAc;AACnG,QAAID,GAAJ,EAAS;AACPV,UAAIY,IAAJ,CAAS,EAACC,SAAQ,IAAT,EAAcC,MAAKJ,GAAnB,EAAT;AACD,KAFD,MAGI;AACF,UAAIC,QAAM,IAAV,EAAgB;AACd;AACA,+BAAII,MAAJ,CAAWb,KAAX,EAAkB,cAAIc,OAAtB,EAA+B,UAACN,GAAD,EAAMO,MAAN,EAAiB;AAC5C,cAAIP,GAAJ,EAAS;AACLV,gBAAIY,IAAJ,CAAS,EAACC,SAAQ,IAAT,EAAcC,MAAKJ,GAAnB,EAAT;AACH,WAFD,MAEO;AACHT;AACH;AACJ,SAND;AAOD,OATD,MAUI;AACFD,YAAIY,IAAJ,CAAS,EAACC,SAAQ,IAAT,EAAcC,MAAK,0BAAnB,EAAT;AACD;AACF;AACF,GAnBD;AAqBH,CAxBD;AAyBA;AACA;AACA;kBACehB,a","file":"authenticated.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport env from \"../env\";\nimport tokenModel from './../models/tokenModel';\nconst authenticated = (req, res, next) => {\n    const token = req.headers['authorization'];\n    var today=new Date();\n    tokenModel.findOne({$and:[{'token':token},{'isActive':'active'},{expiry:{$gt:today}}]},(err, user) =>{\n      if (err) {\n        res.json({isError:true,data:err});\n      }\n      else{\n        if (user!=null) {\n          // console.log(\"-------------\",user);\n          jwt.verify(token, env.App_key, (err, decode) => {\n              if (err) {\n                  res.json({isError:true,data:err})\n              } else {\n                  next()\n              }\n          });\n        }\n        else{\n          res.json({isError:true,data:\"Middle Order Login Again\"})\n        }\n      }\n    });\n\n};\n// const authenticated = (req, res, next) => {\n//\n// }\nexport default authenticated;\n"]}